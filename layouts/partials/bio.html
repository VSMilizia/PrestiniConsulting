{{/* BIO partial: legge da content/<lang>/bio.md */}}

{{ $lang := .Lang }}
{{ $bio := site.GetPage (printf "%s/bio" $lang) }}
{{ if not $bio }}{{ $bio = site.GetPage (printf "/%s/bio" $lang) }}{{ end }}

{{ if $bio }}
  {{ $img := "" }}
  {{ with $bio.Params.image }}
    {{ if hasPrefix . "/" }}
      {{ $img = . }}
    {{ else }}
      {{ with resources.Get . }}
        {{ $img = .RelPermalink }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ $imageRight := default false $bio.Params.imageRight }}
  {{ $bgColor := default "#fff" $bio.Params.bgColor }} {{/* beige di default */}}

    {{/* optional CTA params: button: { text, url, target } */}}
  {{ $btn := $bio.Params.button }}
  {{ $btnText := "" }}
  {{ $btnURL := "" }}
  {{ $btnTarget := "" }}
  {{ if $btn }}
    {{ with $btn.text }}{{ $btnText = . }}{{ end }}
    {{ with $btn.url }}{{ $btnURL = . }}{{ end }}
    {{ with $btn.target }}{{ $btnTarget = . }}{{ end }}
  {{ end }}

  <section class="bio-section" style="background-color: {{ $bgColor }};">
    <div class="bio-container {{ if $imageRight }}image-right{{ end }}">
      <div class="bio-text">

        {{ $bio.Content }}

        {{ if $btnText }}
          {{/* costruisci href: interna se /... */}}
          {{ $href := $btnURL }}
          {{ if and $btnURL (hasPrefix $btnURL "/") }}
            {{ $href = $btnURL | relLangURL }}
          {{ end }}
          <p class="bio-cta-wrap">
            <a class="bio-cta btn btn-small btn-template-main" href="{{ $href | safeURL }}" {{ if $btnTarget }}target="{{ $btnTarget }}" rel="noopener"{{ end }}>
              {{ $btnText }}
            </a>
          </p>
        {{ end }}

      </div>
      
      {{ if $img }}
      <div class="bio-image">
        <img src="{{ $img | relURL }}" alt="{{ $bio.Params.imageAlt }}" />
      </div>
      {{ end }}

    </div>
  </section>

  <style>
    .bio-section {
      padding: 4rem 2rem;
      margin: 0;
    }

    .bio-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      align-items: start;
    }

    .bio-container.image-right {
      grid-template-columns: 1fr 2fr;
    }

    /* testo: diventa flex-column su desktop per "spingere" il bottone in basso */
    .bio-text { padding: 0; }
    @media (min-width: 769px) {
      .bio-text {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        min-height: 100%;
      }
      /* qui il wrapper del bottone prende tutto lo spazio rimanente */
      .bio-cta-wrap { margin-top: auto; }
    }
    @media (max-width: 768px) {
      .bio-cta-wrap { margin-top: 1rem; }
    }


    /* immagine: quadrata, padding 10px e riempie l'altezza della colonna */
    .bio-image {
      padding: 10px;
      display: block;
      width: 100%;
      height: auto;
      aspect-ratio: 1;
      align-self: stretch;
    }

    .bio-image img {
      width: 100%;
      height: 100%;  /* riempi tutto il contenitore */
      object-fit: cover;  /* ritaglia mantenendo le proporzioni */
      display: block;
    }

    @media (max-width: 768px) {
      .bio-container,
      .bio-container.image-right {
        grid-template-columns: 1fr;
      }

      .bio-section {
        padding: 2rem 1rem;
      }
    }
  </style>
{{ end }}
