{{ $lang := .Lang }}
{{ $intro := site.GetPage (printf "%s/intro" $lang) }}
{{ if not $intro }}{{ $intro = site.GetPage (printf "/%s/intro" $lang) }}{{ end }}

{{ if $intro }}
  {{ $img := "" }}
  {{ with $intro.Params.image }}
    {{ if hasPrefix . "/" }}
      {{ $img = . }}
    {{ else }}
      {{ with resources.Get . }}
        {{ $img = .RelPermalink }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ $imageRight := default false $intro.Params.imageRight }}
  {{ $bgColor := default "#fff" $intro.Params.bgColor }} {{/* bianco di default */}}

    {{/* optional CTA params: button: { text, url, target } */}}
  {{ $btn := $intro.Params.button }}
  {{ $btnText := "" }}
  {{ $btnURL := "" }}
  {{ $btnTarget := "" }}
  {{ if $btn }}
    {{ with $btn.text }}{{ $btnText = . }}{{ end }}
    {{ with $btn.url }}{{ $btnURL = . }}{{ end }}
    {{ with $btn.target }}{{ $btnTarget = . }}{{ end }}
  {{ end }}

  <section id="introduction" class="intro-section">
    <div class="intro-container {{ if $imageRight }}image-right{{ end }}">
      <div class="intro-text">

        {{ $intro.Content }}

        {{ if $btnText }}
          {{/* costruisci href: interna se /... */}}
          {{ $href := $btnURL }}
          {{ if and $btnURL (hasPrefix $btnURL "/") }}
            {{ $href = $btnURL | relLangURL }}
          {{ end }}
          <p class="intro-cta-wrap">
            <a class="intro-cta btn btn-small btn-template-main" href="{{ $href | safeURL }}" {{ if $btnTarget }}target="{{ $btnTarget }}" rel="noopener"{{ end }}>
              {{ $btnText }}
            </a>
          </p>
        {{ end }}

      </div>
      
      {{ if $img }}
      <div class="intro-image">
        <img src="{{ $img | relURL }}" alt="{{ $intro.Params.imageAlt }}" />
      </div>
      {{ end }}

    </div>
  </section>

  <style>
    .intro-section {
      padding: 4rem 2rem;
      margin: 0;
      background-color: "{{ $bgColor }}";
    }

    .intro-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 5rem;
      align-items: start;
    }

    /* quando image-right Ã¨ attivo, inverti l'ordine delle colonne */
    .intro-container.image-right {
      grid-template-columns: 1fr 2fr;  /* mantiene proporzioni ma inverte ordine */
    }
    .intro-container.image-right .intro-text {
      order: 2;  /* sposta il testo dopo l'immagine */
    }
    .intro-container.image-right .intro-image {
      order: 1;  /* sposta l'immagine prima del testo */
    }

    /* resto del CSS invariato ma riorganizzato */
    .intro-text { 
      padding: 0;
      font-size:16px;
    }

    @media (min-width: 769px) {
      .intro-text {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        min-height: 100%;
      }
      /* qui il wrapper del bottone prende tutto lo spazio rimanente */
      .intro-cta-wrap { margin-top: auto; }
    }
    @media (max-width: 768px) {
      .intro-cta-wrap { margin-top: 1rem; }
    }


    /* immagine: quadrata, padding 10px e riempie l'altezza della colonna */
    .intro-image {
      padding: 10px;
      aspect-ratio: 1;
      width: 100%;
      height: auto;
    }

    .intro-image img {
      width: 100%;
      height: 100%;  /* riempi tutto il contenitore */
      object-fit: cover;  /* ritaglia mantenendo le proporzioni */
      display: block;
    }

    @media (max-width: 768px) {
      .intro-container,
      .intro-container.image-right {
        grid-template-columns: 1fr;
      }

      .intro-container.image-right .intro-text,
      .intro-container.image-right .intro-image {
        order: 0; /* reset ordine su mobile */
      }

      .intro-section {
        padding: 2rem 1rem;
      }
    }
  </style>
{{ end }}
